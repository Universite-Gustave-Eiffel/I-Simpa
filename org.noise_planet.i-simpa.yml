app-id: org.noise_planet.i-simpa
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: isimpa
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=home
  - --share=network # check if there is a new version of I-SIMPA
  - --env=LD_LIBRARY_PATH=/app/lib:/app/lib64
cleanup:
  - '/include'
  - '/lib/debug'
modules:
  - name: cpm
    buildsystem: simple
    sources:
      - type: file
        url: https://github.com/cpm-cmake/CPM.cmake/releases/download/v0.40.7/CPM.cmake
        sha256: c0fc82149e00c43a21febe7b2ca57b2ffea2b8e88ab867022c21d6b81937eb50
    build-commands:
      - mkdir -p /app/share/cpm
      - install -m 0644 CPM.cmake /app/share/cpm/CPM_0.40.7.cmake
  - name: boost
    buildsystem: cmake
    sources:
      - type: archive
        url: https://github.com/boostorg/boost/releases/download/boost-1.89.0/boost-1.89.0-cmake.tar.gz
        sha256: 954a01219bf818c7fb850fa610c2c8c71a4fa28fa32a1900056bcb6ff58cf908
    config-opts:
      - -DBUILD_TESTING=ON
      - -DBOOST_ENABLE_PYTHON=ON
      - -DBUILD_SHARED_LIBS=ON
      - -DBOOST_INCLUDE_LIBRARIES=system;algorithm;random;filesystem;regex;thread;chrono;test;date_time;python;numeric/conversion
      - -DCMAKE_BUILD_TYPE=Release
  - name: swig
    buildsystem: autotools
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/swig/swig/swig-4.1.1/swig-4.1.1.tar.gz
        sha256: 2af08aced8fcd65cdb5cc62426768914bedc735b1c250325203716f78e39ac9b
    config-opts:
      - --without-maximum-compile-warnings
      - --without-pcre
  - name: glu
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/mesa/glu/-/archive/glu-9.0.3/glu-glu-9.0.3.tar.gz
        sha256: 7e919cbc1b2677b01d65fc28fd36a19d1f3e23d76663020e0f3b82b991475e8b
    post-install:
      - ln -sf /app/lib64/libGLU.so.1 /app/lib/libGLU.so.1
  - name: wxwidgets
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DwxBUILD_SHARED=ON
      - -DwxUSE_OPENGL=ON
      - -DwxUSE_GLCANVAS_EGL=ON
      - -DwxUSE_UNICODE=ON
      - -DwxUSE_LIBTIFF=OFF
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.3.1/wxWidgets-3.3.1.tar.bz2
        sha256: f936c8d694f9c49a367a376f99c751467150a4ed7cbf8f4723ef19b2d2d9998d
  # Generated with flatpak-pip-generator requests --yaml
  - name: python3-requests
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "requests" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e4/37/af0d2ef3967ac0d6113837b44a4f0bfe1328c2b9763bd5b1744520e5cfed/certifi-2025.10.5-py3-none-any.whl
        sha256: 0f212c2744a9bb6de0c56639a6f68afe01ecd92d91f14ae897c4fe7bbeeef0de
      - type: file
        url: https://files.pythonhosted.org/packages/13/69/33ddede1939fdd074bce5434295f38fae7136463422fe4fd3e0e89b98062/charset_normalizer-3.4.4.tar.gz
        sha256: 94537985111c35f28720e43603b8e7b43a6ecfb2ce1d3058bbe955b73404e21a
      - type: file
        url: https://files.pythonhosted.org/packages/0e/61/66938bbb5fc52dbdf84594873d5b51fb1f7c7794e9c0f5bd885f30bc507b/idna-3.11-py3-none-any.whl
        sha256: 771a87f49d9defaf64091e6e6fe9c18d4833f140bd19464795bc32d966ca37ea
      - type: file
        url: https://files.pythonhosted.org/packages/1e/db/4254e3eabe8020b458f1a747140d32277ec7a271daf1d235b70dc0b4e6e3/requests-2.32.5-py3-none-any.whl
        sha256: 2462f94637a34fd532264295e186976db0f5d453d1cdd31473c85a6a161affb6
      - type: file
        url: https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl
        sha256: e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc
  - name: isimpa
    buildsystem: cmake-ninja
    sources:
      - type: dir
        path: src
        dest: src
      - type: dir
        path: currentRelease
        dest: currentRelease
      - type: dir
        path: cmake
        dest: cmake
      - type: file
        path: CMakeLists.txt
      - type: file
        path: DESCRIPTION.txt
      - type: file
        path: LICENSE.md
      - type: file
        path: org.noise_planet.i-simpa.desktop
      - type: file
        path: org.noise_planet.i-simpa.appdata.xml
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCPM_SOURCE_CACHE=/app/share
      - -DBoost_DIR=/app/lib64/cmake/Boost-1.86.0
      - -DBOOST_ROOT=/app
      - -DGLUT_INCLUDE_DIR=/app/include
      - DGLUT_glut_LIBRARY=/app/lib/libglut.so
